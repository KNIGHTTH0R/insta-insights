<!doctype html>
<html>

    <head>
        <title>Insta-insights of {{ username }}</title>
        <script src="{{ url_for('static', filename='js/Chart.js') }}"></script>
        <script src="{{ url_for('static', filename='js/jquery-2.1.3.min.js') }}"></script>
        <script src="{{ url_for('static', filename='js/bootstrap.min.js') }}"></script>
        <script src="{{ url_for('static', filename='js/numeric-1.2.6.min.js') }}"></script>
        <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/bootstrap.min.css') }}">
        <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/likes.css') }}">
        <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/sticky-footer.css') }}">

        <script>
          (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
          (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
          })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

          ga('create', 'UA-42082652-2', 'auto');
          ga('send', 'pageview');

        </script>
    </head>

<body>

<div class="row row-fix">
    <div class="col-md-3 col-centered text-center">
        <h1> {{ username }} </h1>
    </div>
</div>
{% if username != 'edz504' %}
<div class="row row-fix">
    <div class="col-md-3 col-centered text-center">
        <h4> Note: If your insights suck because you have no posts, check out <a href = "/eddie" target="blank"> mine! </a></h4>
    </div>
</div>
{% endif %}

<div class="container">
    <!-- # of likes over account lifetime
    (line chart) -->
    <div class="row row-fix top-buffer">
        <h3 class="text-center"> Likes Over Account Lifetime </h3>
        <div>
            <canvas class="chart-canv" id="like-lifetime"></canvas>
        </div>
    </div>
</div>

<!-- filters 
(pie chart) 
and
type, pic or video
(pie chart) -->
<div class="container">
    <div class="row row-fix top-buffer">
        <div class="half-1">
        <h3 class="text-center"> Filters </h3>
            <canvas class="chart-canv" id="filters" ></canvas>
        </div>
        <div class="half-2">
        <h3 class="text-center"> Image/Video </h3>
            <canvas class="chart-canv" id="type" ></canvas>
        </div>
    </div>
</div>

<!-- average # likes by filter
(bar chart) -->
<div class="container">
    <div class="row row-fix top-buffer">
        <h3 class="text-center"> Average Likes By Filter </h3>
        <div>
            <canvas class="chart-canv" id="like-filter"></canvas>
        </div>
    </div>
</div>

<!-- average # of likes and Total Posts by hour
(bar chart) -->
<div class="container">
    <div class="row row-fix top-buffer">
        <h3 class="text-center"> Average Likes and Total Posts By Hour</h3>
        <div>
            <canvas class="chart-canv" id="like-hour"></canvas>
        </div>
    </div>
</div>

<!-- word and tag counts in caption 
(bar chart) -->
<div class="container">
    <div class="row row-fix top-buffer">
        <h3 class="text-center"> Average Likes by # Words in Caption</h3>
        <div>
            <canvas class="chart-canv" id="likes-caption-word"></canvas>
        </div>
    </div>
</div>

<div class="container">
    <div class="row row-fix top-buffer">
        <h3 class="text-center"> Average Likes by # Tags in Caption</h3>
        <div>
            <canvas class="chart-canv" id="likes-caption-tag"></canvas>
        </div>
    </div>
</div>

<!-- Fans -->
<div class="container">
    <div class="row row-fix top-buffer">
        <div class="text-center bottom-buffer">
            <h1>Your biggest fans</h1>
        </div>
        <div class="col-md-2">
            <a href="#" target="blank" id="fan-1-link">
            <div class="thumbnail">
                <div class="caption">
                    <h4><div id="fan-1-username"> fan-1-username </div></h4>
                    <div id="fan-1-stats"><p>fan-1-stats</p></div>
                </div>    
                    <img src="{{ url_for('static', filename='images/sub_thumb.jpg') }}" id="fan-1-pic"/>
            </div>
            </a>
        </div>
        <div class="col-md-2">
            <a href="#" target="blank" id="fan-2-link">
            <div class="thumbnail">
                <div class="caption">
                    <h4><div id="fan-2-username"> fan-2-username </div></h4>
                    <div id="fan-2-stats"><p>fan-2-stats</p></div>
                </div>    
                    <img src="{{ url_for('static', filename='images/sub_thumb.jpg') }}" id="fan-2-pic"/>
            </div>
            </a>
        </div>
        <div class="col-md-2">
            <a href="#" target="blank" id="fan-3-link">
            <div class="thumbnail">
                <div class="caption">
                    <h4><div id="fan-3-username"> fan-3-username </div></h4>
                    <div id="fan-3-stats"><p>fan-3-stats</p></div>
                </div>    
                    <img src="{{ url_for('static', filename='images/sub_thumb.jpg') }}" id="fan-3-pic"/>
            </div>
            </a>
        </div>
        <div class="col-md-2">
            <a href="#" target="blank" id="fan-4-link">
            <div class="thumbnail">
                <div class="caption">
                    <h4><div id="fan-4-username"> fan-4-username </div></h4>
                    <div id="fan-4-stats"><p>fan-4-stats</p></div>
                </div>    
                    <img src="{{ url_for('static', filename='images/sub_thumb.jpg') }}" id="fan-4-pic"/>
            </div>
            </a>
        </div>
        <div class="col-md-2">
            <a href="#" target="blank" id="fan-5-link">
            <div class="thumbnail">
                <div class="caption">
                    <h4><div id="fan-5-username"> fan-5-username </div></h4>
                    <div id="fan-5-stats"><p>fan-5-stats</p></div>
                </div>    
                    <img src="{{ url_for('static', filename='images/sub_thumb.jpg') }}" id="fan-5-pic"/>
            </div>
            </a>
        </div>
        <div class="col-md-2">
            <a href="#" target="blank" id="fan-6-link">
            <div class="thumbnail">
                <div class="caption">
                    <h4><div id="fan-6-username"> fan-6-username </div></h4>
                    <div id="fan-6-stats"><p>fan-6-stats</p></div>
                </div>    
                    <img src="{{ url_for('static', filename='images/sub_thumb.jpg') }}" id="fan-6-pic"/>
            </div>
            </a>
        </div>
    </div>
</div>

<!-- 100 fans 
(bar chart) -->
<div class="container">
    <div class="row row-fix top-buffer">
        <h3 class="text-center"> Top 50 Fans </h3>
        <div>
            <canvas class="chart-canv" id="fan50"></canvas>
        </div>
    </div>
</div>

<!-- Embarassing -->
<div class="row row-fix top-buffer bottom-buffer">
    <div class="col-md-7 col-centered text-center">
        <h1> Embarassingly, </h1> <h4> you have liked </h4> <h1> {{ sad_count }} </h1> <h4> of your own pictures.  Moreover, out of the {{ total_nofilter_count }} times you hash-tagged #nofilter, </h4> <h1> {{ false_nofilter_count }}</h1> <h4> of those pictures had filters.  Come on. </h4>
    </div>
</div>

<footer class="footer">
    <div class="container">
        <p class="text-muted foot-p"> Made by <a href="http://github.com/edz504" target="blank"> Eddie Zhou </a></p>
    </div>
</footer>

</body>

</html>

<script type="text/javascript">
function arrayRotate(arr, reverse){
  if(reverse)
    arr.push(arr.shift());
  else
    arr.unshift(arr.pop());
  return arr;
} 

// get time zone
var date = new Date();
var offset = date.getTimezoneOffset();
var off_hours = offset / 60;

var ctx_likes = $("#like-lifetime").get(0).getContext("2d");
var likes = JSON.parse('{{ likes | tojson | safe }}');
var blank_times = JSON.parse('{{ blank_times | tojson | safe }}');
var data_like_lifetime = {
    labels: blank_times,
    datasets: [
        {
            label: "Likes_over_pics",
            fillColor: "#ff9d8f",
            strokeColor: "#f26b5d",
            pointColor: "#c0392b",
            pointStrokeColor: "#fff",
            // pointHighlightFill: "#fff",
            // pointHighlightStroke: "rgba(220,220,220,1)",
            data: likes
        }
    ]
};
var chart_like_lifetime = new Chart(ctx_likes).Line(data_like_lifetime, {
    showXLabels: 10,
    tooltipTemplate: "<%= value %>",
});

var filter_counts = JSON.parse('{{ filter_counts | tojson | safe }}');
var type_counts = JSON.parse('{{ type_counts | tojson | safe }}');
var ctx_filters = $("#filters").get(0).getContext("2d");
var chart_filters = new Chart(ctx_filters).Doughnut(filter_counts);
var ctx_type = $("#type").get(0).getContext("2d");
var chart_types = new Chart(ctx_type).Doughnut(type_counts);

var filters = JSON.parse('{{ filters | tojson | safe }}');
var filter_likes = JSON.parse('{{ filter_likes | tojson | safe }}');
var ctx_like_filter = $('#like-filter').get(0).getContext("2d");
var data_like_filter = {
    labels: filters,
    datasets: [
        {
            label: "Likes_over_filters",
            fillColor: '#9b59b6',
            strokeColor: '#8e44ad',
            pointColor: '#8e44ad',
            pointStrokeColor: '#fff',
            data: filter_likes
        }
    ]
};
var chart_like_filter = new Chart(ctx_like_filter).Bar(data_like_filter);


var hours = JSON.parse('{{ hours | tojson | safe }}');
var hour_likes = JSON.parse('{{ hour_likes | tojson | safe }}');
var hour_posts = JSON.parse('{{ hour_posts | tojson | safe }}');

// rotate the three arrays for time zone conversion
for (var i = 0; i < off_hours; i++) {
    hour_likes = arrayRotate(hour_likes, true);
    hour_posts = arrayRotate(hour_posts, true);
}


var ctx_like_hours = $('#like-hour').get(0).getContext("2d");
var data_like_hours = {
    labels: hours,
    datasets: [
        {
            label: "Mean_Likes",
            fillColor: "#A9CCE3",
            strokeColor: "#2980b9",
            pointColor: "#2980b9",
            pointStrokeColor: "#fff",
            data: hour_likes
        },
        {
            label: "Total_Posts",
            fillColor: "#A2D9CE",
            strokeColor: "#16a085",
            pointColor: "#16a085",
            pointStrokeColor: "#fff",
            data: hour_posts
        }
    ]
};
var chart_like_hours = new Chart(ctx_like_hours).Line(data_like_hours, {
    multiTooltipTemplate: "<%= datasetLabel %>: <%= value %>",
    bezierCurve: false
});


var word_labels = JSON.parse('{{ words | tojson | safe }}');
var word_likes = JSON.parse('{{ word_likes | tojson | safe }}');
var ctx_word_likes = $('#likes-caption-word').get(0).getContext("2d");
var data_like_words = {
    labels: word_labels,
    datasets: [
        {
            label: "Likes By Caption Word Length",
            fillColor: '#8E99A5',
            strokeColor: '#34495e',
            pointColor: '#34495e',
            pointStrokeColor: '#fff',
            data: word_likes
        }
    ]
};
var chart_like_words = new Chart(ctx_word_likes).Bar(data_like_words);

var tag_labels = JSON.parse('{{ tags | tojson | safe }}');
var tag_likes = JSON.parse('{{ tag_likes | tojson | safe }}');
var ctx_tag_likes = $('#likes-caption-tag').get(0).getContext("2d");
var data_like_tags = {
    labels: tag_labels,
    datasets: [
        {
            label: "Likes By Caption Word Length",
            fillColor: '#8E99A5',
            strokeColor: '#34495e',
            pointColor: '#34495e',
            pointStrokeColor: '#fff',
            data: tag_likes
        }
    ]
};
var chart_like_tags = new Chart(ctx_tag_likes).Bar(data_like_tags);

var top_fans = JSON.parse('{{ top_fans | tojson | safe }}');

for (var i = 0; i < 6; i++) {
    $('#fan-' + (i + 1) + '-pic').attr("src", top_fans[i]['prof_pic']);
    $('#fan-' + (i + 1) + '-username').text(top_fans[i]['username']);
    $('#fan-' + (i + 1) + '-stats').text("liked " + 
        top_fans[i]['likes'] + "/" + likes.length + " pics");
    $('#fan-' + (i + 1) + '-link').attr("href", "http://instagram.com/" + top_fans[i]['username']);
}

$(document).ready(function() {
    $('.thumbnail').hover(
        function(){
            $(this).find('.caption').slideDown(250); //.fadeIn(250)
        },
        function(){
            $(this).find('.caption').slideUp(250); //.fadeOut(205)
        }
    ); 
});

var fan50_usernames = JSON.parse('{{ fan50_usernames | tojson | safe }}');
var fan50_likes = JSON.parse('{{ fan50_likes | tojson | safe }}');
var ctx_fan50 = $('#fan50').get(0).getContext("2d");
var data_fan50 = {
    labels: fan50_usernames,
    datasets: [
        {
            label: "Fans",
            fillColor: '#e67e22',
            strokeColor: '#d35400',
            pointColor: '#d35400',
            pointStrokeColor: '#fff',
            data: fan50_likes
        }
    ]
};
var chart_fan50 = new Chart(ctx_fan50).Bar(data_fan50);

</script>